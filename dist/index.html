<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>修了証明書発行</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <script type="text/javascript" src="../js/issue_bundle.js"></script>
</head>
<body>
<div class="contents">
  <div class="inner">
    <article>
      <h2>証明書の発行</h2>
    </article>
    <form action="issuer.html" method="post" enctype="multipart/form-data">
      <p><strong>■証明書を発行するにはPDFと秘密鍵(WIF)を入力後、Txブロードキャストボタンを押してください。■</strong><br>
      <hr/>
      <table class="ta1">
        <tr>
          <th>PDF</th>
          <td><input type="file" id="pdf_file" name="pdf_file" size="30" class="ws"></td>
        </tr>
        <tr>
          <th>PDFのハッシュ値(16進数): </th><td id="digest"></td>
        </tr>
      </table>
      <br>
      <table class='ta1'>
        <tr>
          <th>秘密鍵(WIF)</th>
          <td><input type="text" id="secretKey" name="secretKey" size="64" class="ws"></td>
        </tr>
      </table>
      <table class='ta1'>
        <tr>
          <button type="button" onclick="makeAddress(document.getElementById('secretKey').value)">アドレスを確認する</button>
          <th>秘密鍵(WIF)に対応するp2wpkhアドレス: </th><td id="address"></td>
        </tr>
        <tr>
        </tr>
      </table>
      <br>
      <table class="ta1">
        <tr>
          <button type="submit" value="Txブロードキャスト">Txをブロードキャストする</button>
          <th>ブロードキャストしたTxのTxID：</th><label id="result"></label>
        </tr>
      </table>
      <hr/>
      <table class="ta1">
        <tr>
          <th>TxID</th>
          <td><input type="text" id="tx_id" name="tx_id" size="64" class="ws"></td>
        </tr>
        <tr>
          <th>無効TxIDリスト</th>
          <td><input type="text" id="tx_invalid_list" name="tx_invalid_list" size="64" class="ws"></td>
        </tr>
      </table>
      </form>
    <p><a href="index.html">&lt;&lt; Topに戻る</a></p>
  </div>
<!--/inner-->
</div>
<!--/contents-->
</body>
<script>
  function makeDigest(evt){
    document.getElementById('digest').value = '';
    const files = evt.target.files[0];
    console.log(files);
    const reader = new FileReader();
    reader.onload = (function(){
      return function(e){
        console.log(e.target.result);
        document.getElementById('digest').value = getDigest(e.target.result);
        document.getElementById('digest').textContent = getDigest(e.target.result);
      }
    })(files);
    reader.readAsArrayBuffer(files);
  }
  document.getElementById('pdf_file').addEventListener('change', makeDigest, false);
</script>
</html>
